<div class="code-checker-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>qr_code_scanner</mat-icon>
        Attendee Code Verification
      </mat-card-title>
      <mat-card-subtitle>
        Verify and check-in attendees by scanning or entering their unique registration code
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Info Box -->
      <div class="info-box">
        <mat-icon>info</mat-icon>
        <div class="info-content">
          <p><strong>How to use:</strong></p>
          <ul>
            <li>Enter or scan the attendee's unique registration code (e.g., GFAM001)</li>
            <li>Click "Verify Code" to retrieve attendee details</li>
            <li>Review the information and confirm check-in status</li>
          </ul>
        </div>
      </div>

      <form (ngSubmit)="checkCode()">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Enter Attendee Registration Code</mat-label>
          <input
            matInput
            [(ngModel)]="enteredCode"
            name="code"
            required
            placeholder="e.g., GFAM001"
            [disabled]="isLoading"
          />
          <mat-icon matPrefix>confirmation_number</mat-icon>
          <mat-hint>Enter the unique code provided to the attendee</mat-hint>
        </mat-form-field>

        <div class="button-group">
          <button
            mat-flat-button
            color="primary"
            type="submit"
            [disabled]="isLoading || !enteredCode.trim()"
          >
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isLoading">search</mat-icon>
            {{ isLoading ? 'Verifying...' : 'Verify Code' }}
          </button>

          <button
            mat-stroked-button
            type="button"
            (click)="clearSearch()"
            [disabled]="isLoading"
          >
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>
      </form>

      <!-- Success Result -->
      <div *ngIf="attendee && !alreadyCheckedIn" class="result-card success">
        <div class="result-header">
          <mat-icon class="success-icon">check_circle</mat-icon>
          <h3>Attendee Verified Successfully!</h3>
        </div>

        <div class="attendee-details">
          <div class="detail-section">
            <h4><mat-icon>person</mat-icon> Attendee Information</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Full Name:</span>
                <span class="value">{{ attendee.fullName }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Registration Code:</span>
                <span class="value code-highlight">{{ attendee.code }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4><mat-icon>schedule</mat-icon> Prayer Details</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Prayer Time:</span>
                <span class="value">{{ attendee.prayerTime }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Prayer Color:</span>
                <span class="value">{{ attendee.prayerColor }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Tag Colour:</span>
                <span class="value tag-badge" [ngClass]="'tag-' + attendee.tagToIssue.toLowerCase()">{{ attendee.tagToIssue }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4><mat-icon>contact_phone</mat-icon> Coordinator Information</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Coordinator Name:</span>
                <span class="value">{{ attendee.coordinatorName }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Coordinator Phone:</span>
                <span class="value">{{ attendee.coordinatorPhone }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section" *ngIf="attendee.verifiedAt">
            <h4><mat-icon>verified</mat-icon> Verification Info</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Verified At:</span>
                <span class="value">{{ attendee.verifiedAt | date:'medium' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Already Checked In Result -->
      <div *ngIf="attendee && alreadyCheckedIn" class="result-card warning">
        <div class="result-header">
          <mat-icon class="warning-icon">warning</mat-icon>
          <h3>Attendee Already Checked In!</h3>
        </div>

        <div class="attendee-details">
          <div class="detail-section">
            <h4><mat-icon>person</mat-icon> Attendee Information</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Full Name:</span>
                <span class="value">{{ attendee.fullName }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Registration Code:</span>
                <span class="value code-highlight">{{ attendee.code }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4><mat-icon>schedule</mat-icon> Prayer Details</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Prayer Time:</span>
                <span class="value">{{ attendee.prayerTime }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Prayer Color:</span>
                <span class="value">{{ attendee.prayerColor }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Tag Colour:</span>
                <span class="value tag-badge" [ngClass]="'tag-' + attendee.tagToIssue.toLowerCase()">{{ attendee.tagToIssue }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4><mat-icon>contact_phone</mat-icon> Coordinator Information</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Coordinator Name:</span>
                <span class="value">{{ attendee.coordinatorName }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Coordinator Phone:</span>
                <span class="value">{{ attendee.coordinatorPhone }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section" *ngIf="attendee.verifiedAt">
            <h4><mat-icon>verified</mat-icon> Verification Info</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Verified At:</span>
                <span class="value">{{ attendee.verifiedAt | date:'medium' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Result -->
      <div *ngIf="notFound" class="result-card error">
        <div class="result-header">
          <mat-icon class="error-icon">cancel</mat-icon>
          <h3>Attendee Not Found</h3>
        </div>
        <p class="error-message">
          No attendee found with code <strong>"{{ enteredCode }}"</strong>.
          Please verify the code and try again.
        </p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
