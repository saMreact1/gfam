<mat-card>
    <mat-card-header>
        <mat-card-title>Attendees</mat-card-title>

        <div class="actions">
            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Search Attendees</mat-label>
                <input matInput (keyup)="applyFilter($event)" placeholder="Search by name, email, and phone number">
                <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="filter-field">
                <mat-label>Filter by Status</mat-label>
                <mat-select [(value)]="statusFilter" (selectionChange)="applyStatusFilter()">
                    <mat-option value="all">All Attendees</mat-option>
                    <mat-option value="REGISTERED">Registered</mat-option>
                    <mat-option value="CHECKED_IN">Checked In</mat-option>
                    <mat-option value="NO_SHOW">No Show</mat-option>
                    <mat-option value="CANCELLED">Cancelled</mat-option>
                    <mat-option value="VIRTUAL">Virtual</mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <button mat-raised-button color="primary" (click)="downloadCSV()">
            <mat-icon>download</mat-icon> Download List
        </button>
    </mat-card-header>

    <mat-card-content>
        <!-- Loading Spinner -->
        <div *ngIf="isLoading" class="loading-container">
            <mat-spinner diameter="50"></mat-spinner>
            <p>Loading attendees...</p>
        </div>

        <div class="table-container" *ngIf="!isLoading">
            <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">

                <!-- First Name -->
                <ng-container matColumnDef="firstName">
                    <th mat-header-cell *matHeaderCellDef> First Name </th>
                    <td mat-cell *matCellDef="let element">{{element.firstName}}</td>
                </ng-container>

                <!-- Last Name -->
                <ng-container matColumnDef="lastName">
                    <th mat-header-cell *matHeaderCellDef> Last Name </th>
                    <td mat-cell *matCellDef="let element">{{element.lastName}}</td>
                </ng-container>

                <!-- Email -->
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef> Email </th>
                    <td mat-cell *matCellDef="let element">{{element.email}}</td>
                </ng-container>

                <!-- Phone -->
                <ng-container matColumnDef="phone">
                    <th mat-header-cell *matHeaderCellDef> Phone </th>
                    <td mat-cell *matCellDef="let element">{{element.phone}}</td>
                </ng-container>

                <!-- Role -->
                <ng-container matColumnDef="role">
                    <th mat-header-cell *matHeaderCellDef> Role </th>
                    <td mat-cell *matCellDef="let element">{{element.role}}</td>
                </ng-container>

                <!-- Gender -->
                <ng-container matColumnDef="gender">
                    <th mat-header-cell *matHeaderCellDef> Gender </th>
                    <td mat-cell *matCellDef="let element">{{element.gender}}</td>
                </ng-container>

                <!-- Prayer Slot -->
                <ng-container matColumnDef="prayerSlot">
                    <th mat-header-cell *matHeaderCellDef> Prayer Slot </th>
                    <td mat-cell *matCellDef="let element">{{element.prayerSlot || 'N/A'}}</td>
                </ng-container>

                <!-- Registration Status -->
                <ng-container matColumnDef="registrationStatus">
                    <th mat-header-cell *matHeaderCellDef> Status </th>
                    <td mat-cell *matCellDef="let element">
                        <span [class]="getStatusClass(element.registrationStatus)" class="status-badge">
                            {{getStatusLabel(element.registrationStatus)}}
                        </span>
                    </td>
                </ng-container>

                <!-- Code -->
                <ng-container matColumnDef="code">
                    <th mat-header-cell *matHeaderCellDef> Code </th>
                    <td mat-cell *matCellDef="let element">
                        <span class="code-badge">{{element.code}}</span>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <mat-paginator
                [length]="totalElements"
                [pageSize]="pageSize"
                [pageIndex]="pageIndex"
                [pageSizeOptions]="pageSizeOptions"
                (page)="onPageChange($event)"
                showFirstLastButtons>
            </mat-paginator>
        </div>
    </mat-card-content>
</mat-card>
